<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>curl-cpp: curl_easy_get.cc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">curl-cpp
   </div>
   <div id="projectbrief">static c++17 wrapper for curl with -fno-exceptions support</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">curl_easy_get.cc</div>  </div>
</div><!--header-->
<div class="contents">
<p>Why make Easy_ref_t RAII-less?</p>
<p>It would simplify design of Easy_ref_t, since it doesn't need to implement RAII-part logic.</p>
<p>It would also make it easier to use member function of Easy_ref_t in Multi_t, provided that libcurl callback provides CURL* and that option CURLOPT_PRIVATE which enables storing any object, isn't support until 7.10.3.</p>
<p>Easy_ref_t's member function cannot be called in multiple threads simultaneously.</p>
<h3><a class="anchor" id="autotoc_md0"></a>
PERSISTENT CONNECTIONS</h3>
<p>Persistent connections means that libcurl can re-use the same connection for several transfers, if the conditions are right.</p>
<p>libcurl will always attempt to use persistent connections.</p>
<p>Whenever you use Easy_ref_t::perform or Multi::perform/Multi::socket_action, libcurl will attempt to use an existing connection to do the transfer, and if none exists it'll open a new one that will be subject for re-use on a possible following call to these functions.</p>
<p>To allow libcurl to take full advantage of persistent connections, you should do as many of your file transfers as possible using the same handle.</p>
<p>If you use the easy interface, and the Easy_t get destroyed, all the possibly open connections held by libcurl will be closed and forgotten.</p>
<p>When you've created a multi handle and are using the multi interface, the connection pool is instead kept in the multi handle so closing and creating new easy handles to do transfers will not affect them. Instead all added easy handles can take advantage of the single shared pool.</p>
<p>It can also be archieved by using <a class="el" href="classcurl_1_1Share__base.html">curl::Share_base</a> or <a class="el" href="classcurl_1_1Share.html">curl::Share</a> and enable_sharing(Share_base::Options::connection_cache).</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;../curl_easy.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../curl_url.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;utility.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <a name="_a0"></a><a class="code" href="classcurl_1_1curl__t.html">curl::curl_t</a> curl{<span class="keyword">nullptr</span>};</div>
<div class="line">    assert(curl.has_CURLU());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> url = curl.create_Url();</div>
<div class="line">    assert(url.get());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> url_ref = <a name="_a1"></a><a class="code" href="classcurl_1_1Url__ref__t.html">curl::Url_ref_t</a>{url.get()};</div>
<div class="line">    assert_same(url_ref.set_url(<span class="stringliteral">&quot;http://en.cppreference.com/&quot;</span>).get_return_value(), </div>
<div class="line">                curl::Url_ref_t::set_code::ok);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> easy1 = curl.create_easy();</div>
<div class="line">    assert(easy1);</div>
<div class="line"> </div>
<div class="line">    <a name="_a2"></a><a class="code" href="classcurl_1_1Easy__ref__t.html">curl::Easy_ref_t</a> easy_ref1{easy1.get()};</div>
<div class="line"> </div>
<div class="line">    easy_ref1.<a name="a3"></a><a class="code" href="classcurl_1_1Easy__ref__t.html#a69e54a4ca1e2f6c3012465ac14fa32ae">set_url</a>(url_ref);</div>
<div class="line"> </div>
<div class="line">    easy_ref1.setup_establish_connection_only();</div>
<div class="line">    easy_ref1.perform();</div>
<div class="line"> </div>
<div class="line">    easy_ref1.request_get();</div>
<div class="line">    easy_ref1.set_writeback(<span class="keyword">reinterpret_cast&lt;</span>decltype(easy_ref1)::writeback_t<span class="keyword">&gt;</span>(std::fwrite), stdout);</div>
<div class="line"> </div>
<div class="line">    assert_same(easy_ref1.perform().get_return_value(), curl::Easy_ref_t::code::ok);</div>
<div class="line">    assert_same(easy_ref1.get_response_code(), 302L);</div>
<div class="line"> </div>
<div class="line">    easy_ref1.set_url(<span class="stringliteral">&quot;http://en.cppreference.com/&quot;</span>);</div>
<div class="line">    assert_same(easy_ref1.perform().get_return_value(), curl::Easy_ref_t::code::ok);</div>
<div class="line">    assert_same(easy_ref1.get_response_code(), 302L);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> easy2 = curl.dup_easy(easy1);</div>
<div class="line">    assert(easy2);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classcurl_1_1Easy__ref__t.html">curl::Easy_ref_t</a> easy_ref2{easy2.get()};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//constexpr const char expected_response[] = &quot;&lt;!DOCTYPE HTML PUBLIC &quot;;</span></div>
<div class="line">    <span class="comment">//constexpr const auto expected_len = sizeof(expected_response) - 1;</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//std::string response;</span></div>
<div class="line">    <span class="comment">//response.reserve(expected_len);</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//easy_ref2.set_read_writeback(std::pair{response, expected_len});</span></div>
<div class="line">    <span class="comment">//assert_same(easy_ref2.perform().get_return_value(), curl::Easy_ref_t::code::ok);</span></div>
<div class="line">    <span class="comment">//assert_same(easy_ref2.get_response_code(), 302L);</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//assert_same(response, std::string_view{expected_response});</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="aclasscurl_1_1Url__ref__t_html"><div class="ttname"><a href="classcurl_1_1Url__ref__t.html">curl::Url_ref_t</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__url_8hpp_source.html#l00024">curl_url.hpp:24</a></div></div>
<div class="ttc" id="aclasscurl_1_1Easy__ref__t_html"><div class="ttname"><a href="classcurl_1_1Easy__ref__t.html">curl::Easy_ref_t</a></div><div class="ttdef"><b>Definition:</b> <a href="curl__easy_8hpp_source.html#l00053">curl_easy.hpp:53</a></div></div>
<div class="ttc" id="aclasscurl_1_1curl__t_html"><div class="ttname"><a href="classcurl_1_1curl__t.html">curl::curl_t</a></div><div class="ttdef"><b>Definition:</b> <a href="curl_8hpp_source.html#l00062">curl.hpp:62</a></div></div>
<div class="ttc" id="aclasscurl_1_1Easy__ref__t_html_a69e54a4ca1e2f6c3012465ac14fa32ae"><div class="ttname"><a href="classcurl_1_1Easy__ref__t.html#a69e54a4ca1e2f6c3012465ac14fa32ae">curl::Easy_ref_t::set_url</a></div><div class="ttdeci">void set_url(const Url_ref_t &amp;url) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="curl__easy_8cc_source.html#l00097">curl_easy.cc:97</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jul 19 2020 00:14:19 for curl-cpp by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
